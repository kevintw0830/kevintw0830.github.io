window.__require=function t(e,n,o){function i(a,c){if(!n[a]){if(!e[a]){var s=a.split("/");if(s=s[s.length-1],!e[s]){var u="function"==typeof __require&&__require;if(!c&&u)return u(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+a+"'")}}var p=n[a]={exports:{}};e[a][0].call(p.exports,function(t){return i(e[a][1][t]||t)},p,p.exports,t,e,n,o)}return n[a].exports}for(var r="function"==typeof __require&&__require,a=0;a<o.length;a++)i(o[a]);return i}({BgElement:[function(t,e,n){"use strict";cc._RF.push(e,"8d815+DhIlJAI1JBZqq0y1a","BgElement");var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),i=this&&this.__decorate||function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var r=t("../ResMgr"),a=t("../GameConst"),c=t("../GameData"),s=t("./GameElement"),u=cc._decorator,p=u.ccclass,h=u.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.idx_x=-1,e.idx_y=-1,e.myName="",e.myGameElement=null,e.gameScript=null,e.mySprite=null,e.gameElementPrefab=null,e}return o(e,t),e.prototype.start=function(){},e.prototype.init=function(t,e,n){this.idx_x=t,this.idx_y=e,this.gameScript=n,this.myName=this.idx_x+"_"+this.idx_y,this.node.name=this.myName,this.mySprite.spriteFrame=this.getSprite(),this.node.opacity=0,this.addEvent()},e.prototype.addEvent=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchCancel,this)},e.prototype.onTouchStart=function(t){cc.log("onTouchStart")},e.prototype.onTouchEnd=function(t){cc.log("onTouchEnd",c.GameData.arrayValue[this.myName]),this.gameScript.canPlay()&&0==c.GameData.arrayValue[this.myName]&&this.addGameElement()},e.prototype.onTouchCancel=function(t){cc.log("onTouchCancel")},e.prototype.getSprite=function(){return r.default.getAtlasSpriteFrame(a.GameConst.ElementPlist,"card_back")},e.prototype.addGameElement=function(){this.gameScript.setGameStatus(a.Status.anim),c.GameData.arrayValue[this.myName]=c.GameData.nextValue[0],this.gameScript.addElement(),this.myGameElement=cc.instantiate(this.gameElementPrefab),this.node.addChild(this.myGameElement);var t=this.myGameElement.getComponent(s.default);t.init(this.idx_x,this.idx_y,this.gameScript),t.playShow()},e.prototype.playShow=function(){this.node.runAction(cc.fadeIn(.5))},i([h(cc.Sprite)],e.prototype,"mySprite",void 0),i([h(cc.Prefab)],e.prototype,"gameElementPrefab",void 0),e=i([p],e)}(cc.Component);n.default=l,cc._RF.pop()},{"../GameConst":"GameConst","../GameData":"GameData","../ResMgr":"ResMgr","./GameElement":"GameElement"}],EventManager:[function(t,e,n){"use strict";cc._RF.push(e,"22efdADqeJI474nkHel5LKh","EventManager");var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=function(t){function e(){return t.call(this)||this}return o(e,t),Object.defineProperty(e,"instance",{get:function(){return e.eventManager?e.eventManager:e.eventManager=new e},enumerable:!0,configurable:!0}),e.prototype.registerEvent=function(t,e,n,o){void 0===o&&(o=!0),this.on(t,e,n,o)},e.prototype.unregisterEvent=function(t,e,n,o){void 0===o&&(o=!0),this.off(t,e,n,o)},e.prototype.postMsg=function(t,e,n){void 0===e&&(e=[]),void 0===n&&(n=!0);var o=new cc.Event.EventCustom(t,n);o.detail=e,this.dispatchEvent(o)},e.releaseSelf=function(){e.eventManager=null},e.eventManager=null,e}(cc.Node);n.default=i,cc._RF.pop()},{}],GameConst:[function(t,e,n){"use strict";cc._RF.push(e,"1ca12kkMV1G3r/wloV1jFUz","GameConst"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(){}return t.ElementPlist="GameScene/card",t.StartMerge="StartMerge",t.EndMerge="EndMerge",t.nextLength=2,t.randRange=60,t}();n.GameConst=o,function(t){t[t.none=0]="none",t[t.init=1]="init",t[t.start=2]="start",t[t.play=3]="play",t[t.anim=4]="anim",t[t.merge=5]="merge",t[t.end=6]="end"}(n.Status||(n.Status={})),cc._RF.pop()},{}],GameData:[function(t,e,n){"use strict";cc._RF.push(e,"55ac3po9Z9OlaFzN37tbxD3","GameData"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(){}return t.init=function(){this.nextValue=[],this.currMaxValue=1,this.arrayValue=[],this.useCount=0},t.getValue=function(e,n){var o=e+"_"+n;return t.arrayValue[o]},t.setValue=function(e,n,o){var i=e+"_"+n;t.arrayValue[i]=o},t.updateMaxValue=function(t){this.currMaxValue=t},t.spriteKind=3,t.nextValue=[],t.currMaxValue=1,t.arrayValue=[],t.useCount=0,t}();n.GameData=o,cc._RF.pop()},{}],GameElement:[function(t,e,n){"use strict";cc._RF.push(e,"5f0a6KuutdFrJpNZgjEjYwq","GameElement");var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),i=this&&this.__decorate||function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var r=t("../ResMgr"),a=t("../GameConst"),c=t("../GameData"),s=t("../EventManager"),u=cc._decorator,p=u.ccclass,h=u.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.animTime=.2,e.idx_x=-1,e.idx_y=-1,e.myPos=cc.v2(0,0),e.myName="",e.myValue=-1,e.gameScript=null,e.toPos=cc.v2(0,0),e.mergeCount=0,e.dirPos=[cc.v2(-1,0),cc.v2(0,1),cc.v2(1,0),cc.v2(0,-1)],e.mySprite=null,e}return o(e,t),e.prototype.start=function(){},e.prototype.init=function(t,e,n){this.idx_x=t,this.idx_y=e,this.gameScript=n,this.myName=t+"_"+e,this.myPos=cc.v2(t,e),this.myValue=c.GameData.getValue(t,e),this.mySprite.spriteFrame=this.getSprite(),this.node.opacity=0,this.addEvent()},e.prototype.addEvent=function(){s.default.instance.registerEvent(a.GameConst.StartMerge,this.startMerge,this),s.default.instance.registerEvent(a.GameConst.EndMerge,this.endMerge,this)},e.prototype.onDestroy=function(){s.default.instance.unregisterEvent(a.GameConst.StartMerge,this.startMerge,this),s.default.instance.unregisterEvent(a.GameConst.EndMerge,this.endMerge,this)},e.prototype.getSprite=function(){return r.default.getAtlasSpriteFrame(a.GameConst.ElementPlist,"card_"+c.GameData.spriteKind+"_"+this.myValue)},e.prototype.playShow=function(){this.node.runAction(cc.sequence(cc.fadeIn(this.animTime),cc.callFunc(function(){this.tryMerge()}.bind(this))))},e.prototype.playHide=function(){this.gameScript.removeElement(),this.node.runAction(cc.sequence(cc.fadeOut(this.animTime),cc.callFunc(function(){s.default.instance.postMsg(a.GameConst.EndMerge,[this.toPos]),this.node.destroy()}.bind(this))))},e.prototype.tryMerge=function(){this.gameScript.setGameStatus(a.Status.merge);for(var t=function(t){var n=e.dirPos[t],o=cc.v2(e.idx_x+n.x,e.idx_y+n.y);o.x>=0&&o.x<e.gameScript.row&&o.y>=0&&o.y<e.gameScript.col&&e.compare(o.x,o.y)&&(e.node.runAction(cc.sequence(cc.delayTime(e.animTime*(e.mergeCount+1)),cc.callFunc(function(){s.default.instance.postMsg(a.GameConst.StartMerge,[o,this.myPos])}.bind(e)))),e.mergeCount++)},e=this,n=0;n<this.dirPos.length;n++)t(n);0==this.mergeCount&&(this.gameScript.setGameStatus(a.Status.play),this.gameScript.checkGameover())},e.prototype.compare=function(t,e){return c.GameData.getValue(t,e)==this.myValue},e.prototype.startMerge=function(t){cc.log("s",t.target.myName);var e=cc.v2(t.detail[0]);e.x==this.idx_x&&e.y==this.idx_y&&(c.GameData.arrayValue[this.myName]=0,this.toPos=cc.v2(t.detail[1]),this.playHide())},e.prototype.endMerge=function(t){cc.log("e",t.target.myName);var e=cc.v2(t.detail[0]);e.x==this.idx_x&&e.y==this.idx_y&&(this.myValue+=1,c.GameData.arrayValue[this.myName]=this.myValue,this.mySprite.spriteFrame=this.getSprite(),this.mergeCount--,0==this.mergeCount&&this.tryMerge(),this.myValue>c.GameData.currMaxValue&&c.GameData.updateMaxValue(this.myValue))},e.prototype.showScore=function(){},i([h(cc.Sprite)],e.prototype,"mySprite",void 0),e=i([p],e)}(cc.Component);n.default=l,cc._RF.pop()},{"../EventManager":"EventManager","../GameConst":"GameConst","../GameData":"GameData","../ResMgr":"ResMgr"}],GameLogic:[function(t,e,n){"use strict";cc._RF.push(e,"dea7dOxbnxDRa2Pmk9ddq1K","GameLogic");var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),i=this&&this.__decorate||function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var r=t("./GameData"),a=t("./GameConst"),c=cc._decorator,s=c.ccclass,u=(c.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.start=function(){},e.prototype.init=function(){r.GameData.nextValue=[];for(var t=0;t<a.GameConst.nextLength;t++)this.pushNext()},e.prototype.generateNext=function(){var t=0,e=0;do{e=100*Math.random(),t++}while(e>=a.GameConst.randRange&&t<r.GameData.currMaxValue);return t},e.prototype.popNext=function(){return r.GameData.nextValue.shift()},e.prototype.pushNext=function(){r.GameData.nextValue.push(this.generateNext())},e=i([s],e)}(cc.Component));n.default=u,cc._RF.pop()},{"./GameConst":"GameConst","./GameData":"GameData"}],GameScene:[function(t,e,n){"use strict";cc._RF.push(e,"e1016UnLGBCGqrR3ZYQP0Hk","GameScene");var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),i=this&&this.__decorate||function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var r,a=t("./ResMgr"),c=cc._decorator,s=c.ccclass,u=c.property;(function(t){t[t.none=0]="none",t[t.init=1]="init",t[t.start=2]="start",t[t.play=3]="play",t[t.merge=4]="merge",t[t.end=5]="end"})(r||(r={}));var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.row=5,e.col=5,e.width=137,e.height=185,e.spacing=5,e.limitSize=475,e.animTime=.2,e.UINode=null,e.GameNode=null,e.data={},e.info=[],e.max=1,e.useCount=0,e.mergeElement=[],e.spriteType=3,e.gameStatus=r.none,e.btn_node=[],e}return o(e,t),e.prototype.onLoad=function(){cc.loader.loadResDir("GameScene",function(t,e,n){},function(t,e){t?cc.log(t):this.gameStatus=r.init}.bind(this))},e.prototype.start=function(){for(var t=0;t<this.btn_node.length;t++)this.btn_node[t].on(cc.Node.EventType.TOUCH_END,this.select,this)},e.prototype.init=function(){this.gameStatus=r.start,this.node.removeAllChildren(),this.initUI(),this.initData(),this.updateUI(),this.GameNode.scale=this.limitSize/(this.width*this.row)},e.prototype.initUI=function(){this.UINode=new cc.Node,this.UINode.name="UINode",this.node.addChild(this.UINode);for(var t=0;t<2;t++){var e=new cc.Node;e.name="Next"+t,this.UINode.addChild(e),e.addComponent(cc.Sprite).spriteFrame=a.default.getAtlasSpriteFrame("GameScene/card","card_4_13"+t);e.scale=.5,e.setPosition(-cc.winSize.width/2+this.width*(t+1)*.5,cc.winSize.height/2-.5*this.height)}this.GameNode=new cc.Node,this.GameNode.name="GameNode",this.node.addChild(this.GameNode);for(var n=0;n<this.row;n++)for(var o=0;o<this.col;o++)this.createBgItem(n,o)},e.prototype.select=function(t){if(this.gameStatus==r.init||this.gameStatus==r.end||this.gameStatus==r.play){var e=t.target.name,n=Number(e.split("_")[1]);this.row=n,this.col=n,this.init()}},e.prototype.initData=function(){this.max=1,this.useCount=0,this.info=[];for(var t=0;t<2;t++)this.info.push(this.generateNext());for(var e=0;e<this.row;e++)for(var n=0;n<this.col;n++)this.data[e+"_"+n]=0},e.prototype.generateNext=function(){var t=0,e=0;do{e=100*Math.random(),t++}while(e>=60&&t<this.max);return t},e.prototype.updateUI=function(){for(var t=0;t<2;t++)this.UINode.getChildByName("Next"+t).getComponent(cc.Sprite).spriteFrame=a.default.getAtlasSpriteFrame("GameScene/card","card_"+this.spriteType+"_"+this.info[t])},e.prototype.createBgItem=function(t,e){var n=new cc.Node,o=(t+.5-this.row/2)*(this.width+this.spacing),i=(e+.5-this.col/2)*(this.height+this.spacing);n.name=t+"_"+e,n.width=this.width,n.height=this.height,n.setPosition(o,i),n.addComponent(cc.Sprite).spriteFrame=a.default.getAtlasSpriteFrame("GameScene/card","card_back"),this.GameNode.addChild(n),n.opacity=0,n.scale=1.5,n.runAction(cc.sequence(cc.delayTime(.05*(e*this.row+t)),cc.fadeIn(.2),cc.scaleTo(.2,1),cc.callFunc(function(){t==this.row-1&&e==this.col-1&&(this.gameStatus=r.play)}.bind(this)))),n.on(cc.Node.EventType.TOUCH_END,this.mounseUp,this),n.on(cc.Node.EventType.TOUCH_START,this.mounseDown,this),n.on(cc.Node.EventType.TOUCH_CANCEL,this.cancel,this)},e.prototype.createElementItem=function(t,e){var n=new cc.Node;return n.width=this.width,n.height=this.height,n.addComponent(cc.Sprite).spriteFrame=a.default.getAtlasSpriteFrame("GameScene/card","card_"+this.spriteType+"_"+e),t.addChild(n),n.name="element",n},e.prototype.cancel=function(){for(var t=0;t<this.mergeElement.length;t++){var e=this.mergeElement[t];this.GameNode.getChildByName(e).getChildByName("element").stopAllActions()}},e.prototype.mounseDown=function(t){if(this.gameStatus==r.play){cc.log("down",t.target.name);var e=t.target.name;this.preview(e,this.info[0])}},e.prototype.mounseUp=function(t){if(this.gameStatus==r.play){cc.log("up",t.target.name);for(var e=0;e<this.mergeElement.length;e++){var n=this.mergeElement[e];this.GameNode.getChildByName(n).getChildByName("element").stopAllActions()}this.updateGameUI(t.target)}},e.prototype.updateGameUI=function(t){var e=t.name;if(0==this.data[e]){this.useCount++;var n=this.info.shift();this.data[e]=n;var o=t.getChildByName("element");o?o.getComponent(cc.Sprite).spriteFrame=a.default.getAtlasSpriteFrame("GameScene/card","card_"+this.spriteType+"_"+n):o=this.createElementItem(t,n),o.runAction(cc.fadeIn(this.animTime)),o.scale=1,this.merge(e,n),this.info.push(this.generateNext()),this.updateUI()}},e.prototype.preview=function(t,e){this.mergeElement=this.getMergeElement(t,e);for(var n=0;n<this.mergeElement.length;n++){var o=this.mergeElement[n],i=this.GameNode.getChildByName(o).getChildByName("element");i&&i.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(.3,.9),cc.scaleTo(.1,1.1))))}},e.prototype.getMergeElement=function(t,e){var n=t.split("_"),o=[];if(n.length>1){var i,r=Number(n[0]),a=Number(n[1]);if(r>0)""!=(i=this.compare(r-1,a,e))&&o.push(i);if(r<this.row-1)""!=(i=this.compare(r+1,a,e))&&o.push(i);if(a>0)""!=(i=this.compare(r,a-1,e))&&o.push(i);if(a<this.col-1)""!=(i=this.compare(r,a+1,e))&&o.push(i)}return o},e.prototype.merge=function(t,e){this.mergeElement=this.getMergeElement(t,e),this.mergeElement.length>0&&(this.gameStatus=r.merge);for(var n=function(n){var i=o.mergeElement[n];o.data[i]=0,o.useCount--;var c=o.GameNode.getChildByName(i).getChildByName("element");c.scale=1;var s=e+=1;c.stopAllActions(),c.runAction(cc.sequence(cc.delayTime(o.animTime*(n+1)),cc.fadeOut(.1),cc.callFunc(function(){this.GameNode.getChildByName(t).getChildByName("element").getComponent(cc.Sprite).spriteFrame=a.default.getAtlasSpriteFrame("GameScene/card","card_"+this.spriteType+"_"+s),s==e&&(this.gameStatus=r.play)}.bind(o)))),o.data[t]=e,o.max=e>o.max?e:o.max},o=this,i=0;i<this.mergeElement.length;i++)n(i);this.mergeElement.length>0&&(this.mergeElement=this.getMergeElement(t,e),this.GameNode.getChildByName(t).runAction(cc.sequence(cc.delayTime(this.animTime*(this.mergeElement.length+1)),cc.callFunc(function(){this.merge(t,e)}.bind(this))))),this.useCount==this.row*this.col&&(this.gameStatus=r.end,this.showScore())},e.prototype.compare=function(t,e,n){var o=t+"_"+e;return 0!=n&&this.data[o]==n?o:""},e.prototype.showScore=function(){for(var t=0,e=0;e<this.row;e++)for(var n=function(n){var i=e+"_"+n,r=Math.pow(2,o.data[i]);t+=r;var a=o.GameNode.getChildByName(i);a.runAction(cc.sequence(cc.delayTime(.2*(e*o.row+n)),cc.callFunc(function(){var t=this.createScoreItem(r);t.setPosition(a.getPosition()),this.GameNode.addChild(t),t.runAction(cc.moveBy(.3,cc.v2(0,85)))}.bind(o))))},o=this,i=0;i<this.col;i++)n(i);var r=new cc.Node;r.setPosition(0,cc.winSize.height/2-150),r.addComponent(cc.Label).string=t.toString(),this.UINode.addChild(r),this.node.runAction(cc.sequence(cc.delayTime(2),cc.callFunc(function(){}.bind(this))))},e.prototype.restart=function(){this.init()},e.prototype.createScoreItem=function(t){var e=new cc.Node;return e.color=cc.color(255,0,0),e.addComponent(cc.Label).string="+"+t,e},i([u(cc.Node)],e.prototype,"btn_node",void 0),e=i([s],e)}(cc.Component);n.default=p,cc._RF.pop()},{"./ResMgr":void 0}],Game:[function(t,e,n){"use strict";cc._RF.push(e,"b8076Qnys9AOpyVw4sjDATd","Game");var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),i=this&&this.__decorate||function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var r=t("./GameData"),a=t("./Element/BgElement"),c=t("./GameConst"),s=t("./ResMgr"),u=t("./GameLogic"),p=cc._decorator,h=p.ccclass,l=p.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.GameNode=null,e.BgElementPrefab=null,e.NextNode=[],e.gameLogicScript=null,e.restartBtn=null,e.row=3,e.col=3,e.width=137,e.height=185,e.spacing=5,e.limitSize=450,e.gameStatus=c.Status.start,e}return o(e,t),e.prototype.onLoad=function(){cc.loader.loadResDir("GameScene",function(t,e,n){},function(t,e){t?cc.log(t):this.startGame()}.bind(this))},e.prototype.start=function(){this.restartBtn.node.active=!1,this.GameNode.scale=this.limitSize/(this.width*this.row),this.addEvent()},e.prototype.startGame=function(){for(var t=0,e=this.GameNode.childrenCount;t<e;t++)this.GameNode.children[t].destroy();r.GameData.init(),this.gameLogicScript.init();for(var n=function(t){for(var e=function(e){var n=t+"_"+e;r.GameData.arrayValue[n]=0,o.node.runAction(cc.sequence(cc.delayTime(.1*(3*e+t)),cc.callFunc(function(){this.createBgItem(t,e),t==this.row-1&&e==this.col-1&&(this.gameStatus=c.Status.play,this.updateNextUI())}.bind(o))))},n=0;n<o.col;n++)e(n)},o=this,i=0;i<this.row;i++)n(i)},e.prototype.addEvent=function(){this.restartBtn.node.on(cc.Node.EventType.TOUCH_END,this.restart,this)},e.prototype.increaseElement=function(){r.GameData.useCount++,cc.log("a",r.GameData.useCount)},e.prototype.decreaseElement=function(){r.GameData.useCount--,cc.log("d",r.GameData.useCount)},e.prototype.addElement=function(){this.increaseElement(),this.gameLogicScript.popNext(),this.gameLogicScript.pushNext(),this.updateNextUI()},e.prototype.removeElement=function(){this.decreaseElement()},e.prototype.checkGameover=function(){cc.log("c",r.GameData.useCount),this.row*this.col==r.GameData.useCount&&(cc.log("game over"),this.gameOver(),this.gameStatus=c.Status.end)},e.prototype.gameOver=function(){this.restartBtn.node.active=!0},e.prototype.restart=function(){this.restartBtn.node.active=!1,this.startGame()},e.prototype.createBgItem=function(t,e){var n=cc.instantiate(this.BgElementPrefab),o=(t+.5-this.row/2)*(this.width+this.spacing),i=(e+.5-this.col/2)*(this.height+this.spacing);n.setPosition(o,i),this.GameNode.addChild(n);var r=n.getComponent(a.default);r.init(t,e,this),r.playShow()},e.prototype.getNextValue=function(){return this.gameLogicScript.popNext()},e.prototype.setGameStatus=function(t){this.gameStatus=t},e.prototype.canPlay=function(){return this.gameStatus==c.Status.play},e.prototype.updateNextUI=function(){for(var t=0;t<this.NextNode.length;t++)this.NextNode[t].getComponent(cc.Sprite).spriteFrame=s.default.getAtlasSpriteFrame(c.GameConst.ElementPlist,"card_"+r.GameData.spriteKind+"_"+r.GameData.nextValue[t])},i([l(cc.Node)],e.prototype,"GameNode",void 0),i([l(cc.Prefab)],e.prototype,"BgElementPrefab",void 0),i([l(cc.Node)],e.prototype,"NextNode",void 0),i([l(u.default)],e.prototype,"gameLogicScript",void 0),i([l(cc.Button)],e.prototype,"restartBtn",void 0),i([l(cc.Integer)],e.prototype,"row",void 0),i([l(cc.Integer)],e.prototype,"col",void 0),e=i([h],e)}(cc.Component);n.default=m,cc._RF.pop()},{"./Element/BgElement":"BgElement","./GameConst":"GameConst","./GameData":"GameData","./GameLogic":"GameLogic","./ResMgr":"ResMgr"}],ResMgr:[function(t,e,n){"use strict";cc._RF.push(e,"0672ejj2H5NFrgkhM9AJ8of","ResMgr");var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),i=this&&this.__decorate||function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var r=cc._decorator,a=r.ccclass,c=(r.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.getSingleSpriteFrame=function(t){return cc.loader.getRes(t,cc.SpriteFrame)},e.getAtlasSpriteFrame=function(t,e){return cc.loader.getRes(t,cc.SpriteAtlas).getSpriteFrame(e)},e=i([a],e)}(cc.Component));n.default=c,cc._RF.pop()},{}],"use_v2.0.x_cc.Toggle_event":[function(t,e,n){"use strict";cc._RF.push(e,"3cf59PO3mdHbaUFst8VCwiX","use_v2.0.x_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_check=!0),cc._RF.pop()},{}]},{},["BgElement","GameElement","EventManager","Game","GameConst","GameData","GameLogic","GameScene","ResMgr","use_v2.0.x_cc.Toggle_event"]);