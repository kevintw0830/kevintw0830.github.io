window.__require=function t(e,n,r){function o(i,c){if(!n[i]){if(!e[i]){var s=i.split("/");if(s=s[s.length-1],!e[s]){var u="function"==typeof __require&&__require;if(!c&&u)return u(s,!0);if(a)return a(s,!0);throw new Error("Cannot find module '"+i+"'")}i=s}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(t){return o(e[i][1][t]||t)},p,p.exports,t,e,n,r)}return n[i].exports}for(var a="function"==typeof __require&&__require,i=0;i<r.length;i++)o(r[i]);return o}({BgElement:[function(t,e,n){"use strict";cc._RF.push(e,"8d815+DhIlJAI1JBZqq0y1a","BgElement");var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(t,e,n,r){var o,a=arguments.length,i=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,r);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(i=(a<3?o(i):a>3?o(e,n,i):o(e,n))||i);return a>3&&i&&Object.defineProperty(e,n,i),i};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../ResMgr"),i=t("../GameConst"),c=t("../GameData"),s=t("./GameElement"),u=cc._decorator,p=u.ccclass,h=u.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.idx_x=-1,e.idx_y=-1,e.myName="",e.myGameElement=null,e.gameScript=null,e.mySprite=null,e.gameElementPrefab=null,e}return r(e,t),e.prototype.start=function(){},e.prototype.init=function(t,e,n){this.idx_x=t,this.idx_y=e,this.gameScript=n,this.myName=this.idx_x+"_"+this.idx_y,this.node.name=this.myName,this.mySprite.spriteFrame=a.default.getCardSprite(0),this.node.opacity=0,this.addEvent()},e.prototype.addEvent=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchCancel,this)},e.prototype.onTouchStart=function(t){cc.log("onTouchStart")},e.prototype.onTouchEnd=function(t){cc.log("onTouchEnd",c.GameData.arrayValue[this.myName]),this.gameScript.canPlay()&&0==c.GameData.arrayValue[this.myName]&&this.addGameElement()},e.prototype.onTouchCancel=function(t){cc.log("onTouchCancel")},e.prototype.addGameElement=function(t){void 0===t&&(t=!1),this.gameScript.setGameStatus(i.Status.anim),c.GameData.arrayValue[this.myName]=c.GameData.nextValue[0],this.myGameElement=cc.instantiate(this.gameElementPrefab),this.node.addChild(this.myGameElement);var e=this.myGameElement.getComponent(s.default);e.init(this.idx_x,this.idx_y,this.gameScript,t),e.playShow(),this.gameScript.addElement()},e.prototype.playShow=function(){this.node.runAction(cc.fadeIn(.5))},o([h(cc.Sprite)],e.prototype,"mySprite",void 0),o([h(cc.Prefab)],e.prototype,"gameElementPrefab",void 0),e=o([p],e)}(cc.Component);n.default=m,cc._RF.pop()},{"../GameConst":"GameConst","../GameData":"GameData","../ResMgr":"ResMgr","./GameElement":"GameElement"}],EventManager:[function(t,e,n){"use strict";cc._RF.push(e,"22efdADqeJI474nkHel5LKh","EventManager");var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){function e(){return t.call(this)||this}return r(e,t),Object.defineProperty(e,"instance",{get:function(){return e.eventManager?e.eventManager:e.eventManager=new e},enumerable:!0,configurable:!0}),e.prototype.registerEvent=function(t,e,n,r){void 0===r&&(r=!0),this.on(t,e,n,r)},e.prototype.unregisterEvent=function(t,e,n,r){void 0===r&&(r=!0),this.off(t,e,n,r)},e.prototype.postMsg=function(t,e,n){void 0===e&&(e=[]),void 0===n&&(n=!0);var r=new cc.Event.EventCustom(t,n);r.detail=e,this.dispatchEvent(r)},e.releaseSelf=function(){e.eventManager=null},e.eventManager=null,e}(cc.Node);n.default=o,cc._RF.pop()},{}],GameConst:[function(t,e,n){"use strict";cc._RF.push(e,"1ca12kkMV1G3r/wloV1jFUz","GameConst"),Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(){}return t.ElementPlist="GameScene/card",t.StartMerge="StartMerge",t.EndMerge="EndMerge",t.nextLength=2,t.randRange=60,t.startMax=2,t.test=!1,t}();n.GameConst=r,function(t){t[t.none=0]="none",t[t.init=1]="init",t[t.start=2]="start",t[t.play=3]="play",t[t.anim=4]="anim",t[t.merge=5]="merge",t[t.end=6]="end"}(n.Status||(n.Status={})),function(t){t[t.destoryAll=-2]="destoryAll",t[t.destory=-1]="destory",t[t.back=0]="back"}(n.CardType||(n.CardType={})),cc._RF.pop()},{}],GameData:[function(t,e,n){"use strict";cc._RF.push(e,"55ac3po9Z9OlaFzN37tbxD3","GameData"),Object.defineProperty(n,"__esModule",{value:!0});var r=t("./GameConst"),o=function(){function t(){}return t.init=function(){this.nextValue=[],this.currMaxValue=r.GameConst.startMax,this.currMinValue=1,this.arrayValue=[],this.useCount=0,this.currStep=0,this.numberCountArray=[],this.mergeNumberArray=[],this.mergeCountArray=[],this.destoryStepArray=[]},t.AddNumberCount=function(t){this.numberCountArray[t]?this.numberCountArray[t]++:this.numberCountArray[t]=1},t.GetNumberCount=function(t){return this.numberCountArray[t]?this.numberCountArray[t]:0},t.AddMergeNumber=function(t){this.mergeNumberArray[t]?this.mergeNumberArray[t]++:this.mergeNumberArray[t]=1},t.GetMergeNumber=function(t){return this.mergeNumberArray[t]?this.mergeNumberArray[t]:0},t.AddMergeCount=function(t){this.mergeCountArray[t]?this.mergeCountArray[t]++:this.mergeCountArray[t]=1},t.getValue=function(e,n){var r=e+"_"+n;return t.arrayValue[r]},t.setValue=function(e,n,r){var o=e+"_"+n;t.arrayValue[o]=r},t.updateMaxValue=function(t){this.currMaxValue=t},t.spriteKind=3,t.nextValue=[],t.currMaxValue=2,t.currMinValue=1,t.arrayValue=[],t.useCount=0,t.currStep=0,t.numberCountArray=[],t.mergeNumberArray=[],t.mergeCountArray=[],t.destoryStepArray=[],t}();n.GameData=o,cc._RF.pop()},{"./GameConst":"GameConst"}],GameElement:[function(t,e,n){"use strict";cc._RF.push(e,"5f0a6KuutdFrJpNZgjEjYwq","GameElement");var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(t,e,n,r){var o,a=arguments.length,i=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,r);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(i=(a<3?o(i):a>3?o(e,n,i):o(e,n))||i);return a>3&&i&&Object.defineProperty(e,n,i),i};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../ResMgr"),i=t("../GameConst"),c=t("../GameData"),s=t("../EventManager"),u=cc._decorator,p=u.ccclass,h=u.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.animTime=.2,e.idx_x=-1,e.idx_y=-1,e.myPos=cc.v2(0,0),e.myName="",e.myValue=-1,e.gameScript=null,e.toPos=cc.v2(0,0),e.mergeCount=0,e.isSpecialCard=!1,e.dir4=[cc.v2(-1,0),cc.v2(0,1),cc.v2(1,0),cc.v2(0,-1)],e.dir8=[cc.v2(-1,0),cc.v2(-1,1),cc.v2(0,1),cc.v2(1,1),cc.v2(1,0),cc.v2(1,-1),cc.v2(0,-1),cc.v2(-1,-1)],e.mySprite=null,e}return r(e,t),e.prototype.start=function(){},e.prototype.init=function(t,e,n,r){if(void 0===r&&(r=!1),this.idx_x=t,this.idx_y=e,this.gameScript=n,this.myName=t+"_"+e,this.myPos=cc.v2(t,e),this.myValue=c.GameData.getValue(t,e),this.isSpecialCard=this.myValue==i.CardType.destory||this.myValue==i.CardType.destoryAll,this.mySprite.spriteFrame=a.default.getCardSprite(this.myValue),this.node.opacity=0,c.GameData.AddNumberCount(this.myValue),!r)if(this.isSpecialCard){var o=this.myValue==i.CardType.destory?c.GameData.currStep:10*c.GameData.currStep;c.GameData.destoryStepArray.push(o)}else c.GameData.currStep++;this.addEvent()},e.prototype.addEvent=function(){s.default.instance.registerEvent(i.GameConst.StartMerge,this.startMerge,this),s.default.instance.registerEvent(i.GameConst.EndMerge,this.endMerge,this)},e.prototype.onDestroy=function(){s.default.instance.unregisterEvent(i.GameConst.StartMerge,this.startMerge,this),s.default.instance.unregisterEvent(i.GameConst.EndMerge,this.endMerge,this)},e.prototype.playShow=function(){this.node.runAction(cc.sequence(cc.fadeIn(this.animTime),cc.callFunc(function(){this.tryMerge()}.bind(this))))},e.prototype.playHide=function(){this.gameScript.removeElement(),this.node.runAction(cc.sequence(cc.fadeOut(this.animTime),cc.callFunc(function(){s.default.instance.postMsg(i.GameConst.EndMerge,[this.toPos]),this.node.destroy()}.bind(this))))},e.prototype.tryMerge=function(){this.gameScript.setGameStatus(i.Status.merge);for(var t=this.myValue==i.CardType.destoryAll?this.dir8:this.dir4,e=function(e){var r=t[e],o=cc.v2(n.idx_x+r.x,n.idx_y+r.y);if(o.x>=0&&o.x<n.gameScript.row&&o.y>=0&&o.y<n.gameScript.col&&n.compare(o.x,o.y)){var a=n.isSpecialCard?n.animTime:n.animTime*(n.mergeCount+1);n.node.runAction(cc.sequence(cc.delayTime(a),cc.callFunc(function(){s.default.instance.postMsg(i.GameConst.StartMerge,[o,this.myPos])}.bind(n)))),n.mergeCount++}},n=this,r=0;r<t.length;r++)e(r);cc.log("a = ",this.mergeCount),0==this.mergeCount?(this.isSpecialCard&&(c.GameData.arrayValue[this.myName]=0,this.gameScript.removeElement(),this.node.destroy()),this.gameScript.setGameStatus(i.Status.play),this.gameScript.checkGameover()):this.isSpecialCard||c.GameData.AddMergeCount(this.mergeCount)},e.prototype.compare=function(t,e){var n=c.GameData.getValue(t,e);return n==this.myValue||!(!this.isSpecialCard||n==i.CardType.back)},e.prototype.startMerge=function(t){cc.log("s",t.target.myName);var e=cc.v2(t.detail[0]);e.x==this.idx_x&&e.y==this.idx_y&&(c.GameData.arrayValue[this.myName]=0,this.toPos=cc.v2(t.detail[1]),this.playHide())},e.prototype.endMerge=function(t){cc.log("e",t.target.myName);var e=cc.v2(t.detail[0]);e.x==this.idx_x&&e.y==this.idx_y&&(this.isSpecialCard?(this.mergeCount--,0==this.mergeCount&&this.tryMerge()):(this.myValue+=1,c.GameData.arrayValue[this.myName]=this.myValue,this.mySprite.spriteFrame=a.default.getCardSprite(this.myValue),this.mergeCount--,0==this.mergeCount&&(c.GameData.AddMergeNumber(this.myValue),this.tryMerge()),this.myValue>c.GameData.currMaxValue&&c.GameData.updateMaxValue(this.myValue)))},e.prototype.showScore=function(){},o([h(cc.Sprite)],e.prototype,"mySprite",void 0),e=o([p],e)}(cc.Component);n.default=m,cc._RF.pop()},{"../EventManager":"EventManager","../GameConst":"GameConst","../GameData":"GameData","../ResMgr":"ResMgr"}],GameLogic:[function(t,e,n){"use strict";cc._RF.push(e,"dea7dOxbnxDRa2Pmk9ddq1K","GameLogic");var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(t,e,n,r){var o,a=arguments.length,i=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,r);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(i=(a<3?o(i):a>3?o(e,n,i):o(e,n))||i);return a>3&&i&&Object.defineProperty(e,n,i),i};Object.defineProperty(n,"__esModule",{value:!0});var a=t("./GameData"),i=t("./GameConst"),c=cc._decorator,s=c.ccclass,u=(c.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.nextDestoryStep=0,e.showDestoryAllTimes=0,e.destoryTimes=0,e}return r(e,t),e.prototype.start=function(){},e.prototype.init=function(){this.difficultValue=i.GameConst.randRange,a.GameData.nextValue=[];for(var t=0;t<i.GameConst.nextLength;t++)this.pushNext();this.destoryTimes=0,this.nextDestoryStep=this.getRandomRange(55,70),this.showDestoryAllTimes=this.getRandomRange(3,5),console.log("NEXTALL=",this.nextDestoryStep,this.showDestoryAllTimes)},e.prototype.generateNext=function(){if(a.GameData.currStep>0&&a.GameData.currStep>=this.nextDestoryStep)return this.destoryTimes>=this.showDestoryAllTimes?(this.nextDestoryStep=a.GameData.currStep+this.getRandomRange(45,65),this.showDestoryAllTimes=this.destoryTimes+this.getRandomRange(3,5),this.destoryTimes++,console.log("NEXT=",this.nextDestoryStep,this.showDestoryAllTimes,this.destoryTimes),i.CardType.destoryAll):(this.nextDestoryStep=a.GameData.currStep+this.getRandomRange(30,50),this.destoryTimes++,console.log("NEXT=",this.nextDestoryStep,this.destoryTimes),i.CardType.destory);var t=a.GameData.currMinValue-1,e=0;do{e=this.getRandomRange(0,100),cc.log("R=",e),t++}while(e>=this.difficultValue&&t<a.GameData.currMaxValue);return t},e.prototype.popNext=function(){return a.GameData.nextValue.shift()},e.prototype.pushNext=function(){a.GameData.nextValue.push(this.generateNext())},e.prototype.getRandom=function(t,e){return void 0===e&&(e=0),Math.floor(Math.random()*t)+e},e.prototype.getRandomRange=function(t,e){var n=t+Math.floor(Math.random()*(e-t+1));return cc.log("Rand = ",n,t,e),n},e=o([s],e)}(cc.Component));n.default=u,cc._RF.pop()},{"./GameConst":"GameConst","./GameData":"GameData"}],GameScene:[function(t,e,n){"use strict";cc._RF.push(e,"e1016UnLGBCGqrR3ZYQP0Hk","GameScene");var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(t,e,n,r){var o,a=arguments.length,i=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,r);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(i=(a<3?o(i):a>3?o(e,n,i):o(e,n))||i);return a>3&&i&&Object.defineProperty(e,n,i),i};Object.defineProperty(n,"__esModule",{value:!0});var a,i=t("./ResMgr"),c=cc._decorator,s=c.ccclass,u=c.property;(function(t){t[t.none=0]="none",t[t.init=1]="init",t[t.start=2]="start",t[t.play=3]="play",t[t.merge=4]="merge",t[t.end=5]="end"})(a||(a={}));var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.row=5,e.col=5,e.width=137,e.height=185,e.spacing=5,e.limitSize=475,e.animTime=.2,e.UINode=null,e.GameNode=null,e.data={},e.info=[],e.max=1,e.useCount=0,e.mergeElement=[],e.spriteType=3,e.gameStatus=a.none,e.btn_node=[],e}return r(e,t),e.prototype.onLoad=function(){cc.loader.loadResDir("GameScene",function(t,e,n){},function(t,e){t?cc.log(t):this.gameStatus=a.init}.bind(this))},e.prototype.start=function(){for(var t=0;t<this.btn_node.length;t++)this.btn_node[t].on(cc.Node.EventType.TOUCH_END,this.select,this)},e.prototype.init=function(){this.gameStatus=a.start,this.node.removeAllChildren(),this.initUI(),this.initData(),this.updateUI(),this.GameNode.scale=this.limitSize/(this.width*this.row)},e.prototype.initUI=function(){this.UINode=new cc.Node,this.UINode.name="UINode",this.node.addChild(this.UINode);for(var t=0;t<2;t++){var e=new cc.Node;e.name="Next"+t,this.UINode.addChild(e),e.addComponent(cc.Sprite).spriteFrame=i.default.getAtlasSpriteFrame("GameScene/card","card_4_13"+t);e.scale=.5,e.setPosition(-cc.winSize.width/2+this.width*(t+1)*.5,cc.winSize.height/2-.5*this.height)}this.GameNode=new cc.Node,this.GameNode.name="GameNode",this.node.addChild(this.GameNode);for(var n=0;n<this.row;n++)for(var r=0;r<this.col;r++)this.createBgItem(n,r)},e.prototype.select=function(t){if(this.gameStatus==a.init||this.gameStatus==a.end||this.gameStatus==a.play){var e=t.target.name,n=Number(e.split("_")[1]);this.row=n,this.col=n,this.init()}},e.prototype.initData=function(){this.max=1,this.useCount=0,this.info=[];for(var t=0;t<2;t++)this.info.push(this.generateNext());for(var e=0;e<this.row;e++)for(var n=0;n<this.col;n++)this.data[e+"_"+n]=0},e.prototype.generateNext=function(){var t=0,e=0;do{e=100*Math.random(),t++}while(e>=60&&t<this.max);return t},e.prototype.updateUI=function(){for(var t=0;t<2;t++)this.UINode.getChildByName("Next"+t).getComponent(cc.Sprite).spriteFrame=i.default.getAtlasSpriteFrame("GameScene/card","card_"+this.spriteType+"_"+this.info[t])},e.prototype.createBgItem=function(t,e){var n=new cc.Node,r=(t+.5-this.row/2)*(this.width+this.spacing),o=(e+.5-this.col/2)*(this.height+this.spacing);n.name=t+"_"+e,n.width=this.width,n.height=this.height,n.setPosition(r,o),n.addComponent(cc.Sprite).spriteFrame=i.default.getAtlasSpriteFrame("GameScene/card","card_back"),this.GameNode.addChild(n),n.opacity=0,n.scale=1.5,n.runAction(cc.sequence(cc.delayTime(.05*(e*this.row+t)),cc.fadeIn(.2),cc.scaleTo(.2,1),cc.callFunc(function(){t==this.row-1&&e==this.col-1&&(this.gameStatus=a.play)}.bind(this)))),n.on(cc.Node.EventType.TOUCH_END,this.mounseUp,this),n.on(cc.Node.EventType.TOUCH_START,this.mounseDown,this),n.on(cc.Node.EventType.TOUCH_CANCEL,this.cancel,this)},e.prototype.createElementItem=function(t,e){var n=new cc.Node;return n.width=this.width,n.height=this.height,n.addComponent(cc.Sprite).spriteFrame=i.default.getAtlasSpriteFrame("GameScene/card","card_"+this.spriteType+"_"+e),t.addChild(n),n.name="element",n},e.prototype.cancel=function(){for(var t=0;t<this.mergeElement.length;t++){var e=this.mergeElement[t];this.GameNode.getChildByName(e).getChildByName("element").stopAllActions()}},e.prototype.mounseDown=function(t){if(this.gameStatus==a.play){cc.log("down",t.target.name);var e=t.target.name;this.preview(e,this.info[0])}},e.prototype.mounseUp=function(t){if(this.gameStatus==a.play){cc.log("up",t.target.name);for(var e=0;e<this.mergeElement.length;e++){var n=this.mergeElement[e];this.GameNode.getChildByName(n).getChildByName("element").stopAllActions()}this.updateGameUI(t.target)}},e.prototype.updateGameUI=function(t){var e=t.name;if(0==this.data[e]){this.useCount++;var n=this.info.shift();this.data[e]=n;var r=t.getChildByName("element");r?r.getComponent(cc.Sprite).spriteFrame=i.default.getAtlasSpriteFrame("GameScene/card","card_"+this.spriteType+"_"+n):r=this.createElementItem(t,n),r.runAction(cc.fadeIn(this.animTime)),r.scale=1,this.merge(e,n),this.info.push(this.generateNext()),this.updateUI()}},e.prototype.preview=function(t,e){this.mergeElement=this.getMergeElement(t,e);for(var n=0;n<this.mergeElement.length;n++){var r=this.mergeElement[n],o=this.GameNode.getChildByName(r).getChildByName("element");o&&o.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(.3,.9),cc.scaleTo(.1,1.1))))}},e.prototype.getMergeElement=function(t,e){var n=t.split("_"),r=[];if(n.length>1){var o,a=Number(n[0]),i=Number(n[1]);if(a>0)""!=(o=this.compare(a-1,i,e))&&r.push(o);if(a<this.row-1)""!=(o=this.compare(a+1,i,e))&&r.push(o);if(i>0)""!=(o=this.compare(a,i-1,e))&&r.push(o);if(i<this.col-1)""!=(o=this.compare(a,i+1,e))&&r.push(o)}return r},e.prototype.merge=function(t,e){this.mergeElement=this.getMergeElement(t,e),this.mergeElement.length>0&&(this.gameStatus=a.merge);for(var n=function(n){var o=r.mergeElement[n];r.data[o]=0,r.useCount--;var c=r.GameNode.getChildByName(o).getChildByName("element");c.scale=1;var s=e+=1;c.stopAllActions(),c.runAction(cc.sequence(cc.delayTime(r.animTime*(n+1)),cc.fadeOut(.1),cc.callFunc(function(){this.GameNode.getChildByName(t).getChildByName("element").getComponent(cc.Sprite).spriteFrame=i.default.getAtlasSpriteFrame("GameScene/card","card_"+this.spriteType+"_"+s),s==e&&(this.gameStatus=a.play)}.bind(r)))),r.data[t]=e,r.max=e>r.max?e:r.max},r=this,o=0;o<this.mergeElement.length;o++)n(o);this.mergeElement.length>0&&(this.mergeElement=this.getMergeElement(t,e),this.GameNode.getChildByName(t).runAction(cc.sequence(cc.delayTime(this.animTime*(this.mergeElement.length+1)),cc.callFunc(function(){this.merge(t,e)}.bind(this))))),this.useCount==this.row*this.col&&(this.gameStatus=a.end,this.showScore())},e.prototype.compare=function(t,e,n){var r=t+"_"+e;return 0!=n&&this.data[r]==n?r:""},e.prototype.showScore=function(){for(var t=0,e=0;e<this.row;e++)for(var n=function(n){var o=e+"_"+n,a=Math.pow(2,r.data[o]);t+=a;var i=r.GameNode.getChildByName(o);i.runAction(cc.sequence(cc.delayTime(.2*(e*r.row+n)),cc.callFunc(function(){var t=this.createScoreItem(a);t.setPosition(i.getPosition()),this.GameNode.addChild(t),t.runAction(cc.moveBy(.3,cc.v2(0,85)))}.bind(r))))},r=this,o=0;o<this.col;o++)n(o);var a=new cc.Node;a.setPosition(0,cc.winSize.height/2-150),a.addComponent(cc.Label).string=t.toString(),this.UINode.addChild(a),this.node.runAction(cc.sequence(cc.delayTime(2),cc.callFunc(function(){}.bind(this))))},e.prototype.restart=function(){this.init()},e.prototype.createScoreItem=function(t){var e=new cc.Node;return e.color=cc.color(255,0,0),e.addComponent(cc.Label).string="+"+t,e},o([u(cc.Node)],e.prototype,"btn_node",void 0),e=o([s],e)}(cc.Component);n.default=p,cc._RF.pop()},{"./ResMgr":void 0}],Game:[function(t,e,n){"use strict";cc._RF.push(e,"b8076Qnys9AOpyVw4sjDATd","Game");var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(t,e,n,r){var o,a=arguments.length,i=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,r);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(i=(a<3?o(i):a>3?o(e,n,i):o(e,n))||i);return a>3&&i&&Object.defineProperty(e,n,i),i};Object.defineProperty(n,"__esModule",{value:!0});var a=t("./GameData"),i=t("./Element/BgElement"),c=t("./GameConst"),s=t("./ResMgr"),u=t("./GameLogic"),p=cc._decorator,h=p.ccclass,m=p.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.GameNode=null,e.StepLabel=null,e.EndInfoLabel=null,e.btn_node=[],e.BgElementPrefab=null,e.NextNode=[],e.gameLogicScript=null,e.restartBtn=null,e.row=3,e.col=3,e.width=137,e.height=185,e.spacing=5,e.limitSize=450,e.gameStatus=c.Status.start,e}return r(e,t),e.prototype.onLoad=function(){this.setBtnEnable(!1),cc.loader.loadResDir("GameScene",function(t,e,n){},function(t,e){t?cc.log(t):this.setBtnEnable(!0)}.bind(this));var t=new Object;t=function(){var t=location.search,e=new Object;if(-1!=t.indexOf("?"))for(var n=t.substr(1).split("&"),r=0;r<n.length;r++)e[n[r].split("=")[0]]=unescape(n[r].split("=")[1]);return e}(),c.GameConst.test=1==t.test},e.prototype.start=function(){this.GameNode.scale=this.limitSize/(this.width*this.row),this.addEvent(),this.setBtnEnable(!1)},e.prototype.startGame=function(){this.EndInfoLabel.node.active=!1;for(var t=0,e=this.GameNode.childrenCount;t<e;t++)this.GameNode.children[t].destroy();a.GameData.init(),this.gameLogicScript.init();for(var n=function(t){for(var e=function(e){var n=t+"_"+e;a.GameData.arrayValue[n]=0,r.node.runAction(cc.sequence(cc.delayTime(.1*(3*e+t)),cc.callFunc(function(){this.createBgItem(t,e),t==this.row-1&&e==this.col-1&&(this.gameStatus=c.Status.play,this.updateUI())}.bind(r))))},n=0;n<r.col;n++)e(n)},r=this,o=0;o<this.row;o++)n(o);this.StepLabel.string=a.GameData.currStep+""},e.prototype.addEvent=function(){this.restartBtn.node.on(cc.Node.EventType.TOUCH_END,this.restart,this);for(var t=0;t<this.btn_node.length;t++)this.btn_node[t].node.on(cc.Node.EventType.TOUCH_END,this.select,this)},e.prototype.increaseElement=function(){a.GameData.useCount++,cc.log("a",a.GameData.useCount)},e.prototype.decreaseElement=function(){a.GameData.useCount--,cc.log("d",a.GameData.useCount)},e.prototype.addElement=function(){this.increaseElement(),this.gameLogicScript.popNext(),this.gameLogicScript.pushNext(),this.updateUI()},e.prototype.removeElement=function(){this.decreaseElement()},e.prototype.checkGameover=function(){cc.log("c",a.GameData.useCount),this.row*this.col==a.GameData.useCount&&(cc.log("game over"),this.gameOver(),this.gameStatus=c.Status.end)},e.prototype.gameOver=function(){this.setBtnEnable(!0),this.EndInfoLabel.node.active=!0;var t="MergeCount\n";a.GameData.mergeCountArray.forEach(function(e,n){t=t+n+":"+e+"\n"}),t+="NumberCount\n";for(var e=-2;e<13;e++)(a.GameData.GetMergeNumber(e)>0||a.GameData.GetNumberCount(e)>0)&&(t=t+e+":"+a.GameData.GetMergeNumber(e)+"/"+a.GameData.GetNumberCount(e)+"\n");t+="Step\n";for(e=0;e<a.GameData.destoryStepArray.length;e++)t=t+a.GameData.destoryStepArray[e]+",";this.EndInfoLabel.string=t,cc.log(t);var n=function(e){e.clipboardData.setData("text/plain",t),e.preventDefault()}.bind(this);document.addEventListener("copy",n),document.execCommand("copy"),document.removeEventListener("copy",n)},e.prototype.restart=function(){this.setBtnEnable(!1),this.startGame()},e.prototype.setBtnEnable=function(t){for(var e=0;e<this.btn_node.length;e++)this.btn_node[e].node.active=t,this.btn_node[e].interactable=t},e.prototype.select=function(t){if(this.gameStatus!=c.Status.play){var e=t.target.name,n=Number(e.split("_")[1]);this.row=n,this.col=n,this.GameNode.scale=this.limitSize/(this.width*this.row),this.restart()}},e.prototype.createBgItem=function(t,e){var n=cc.instantiate(this.BgElementPrefab),r=(t+.5-this.row/2)*(this.width+this.spacing),o=(e+.5-this.col/2)*(this.height+this.spacing);n.setPosition(r,o),this.GameNode.addChild(n);var a=n.getComponent(i.default);a.init(t,e,this),a.playShow()},e.prototype.getNextValue=function(){return this.gameLogicScript.popNext()},e.prototype.setGameStatus=function(t){this.gameStatus=t},e.prototype.canPlay=function(){return this.gameStatus==c.Status.play},e.prototype.updateUI=function(){this.updateStepUI(),this.updateNextUI()},e.prototype.updateStepUI=function(){this.StepLabel.string=a.GameData.currStep+""},e.prototype.updateNextUI=function(){for(var t=0;t<this.NextNode.length;t++)this.NextNode[t].getComponent(cc.Sprite).spriteFrame=s.default.getCardSprite(a.GameData.nextValue[t])},e.prototype.randomInitElement=function(){for(var t=[],e=0;e<this.row;e++)t.push(e);Math.floor(Math.random()*this.row),Math.floor(Math.random()*this.col)},o([m(cc.Node)],e.prototype,"GameNode",void 0),o([m(cc.Label)],e.prototype,"StepLabel",void 0),o([m(cc.Label)],e.prototype,"EndInfoLabel",void 0),o([m(cc.Button)],e.prototype,"btn_node",void 0),o([m(cc.Prefab)],e.prototype,"BgElementPrefab",void 0),o([m(cc.Node)],e.prototype,"NextNode",void 0),o([m(u.default)],e.prototype,"gameLogicScript",void 0),o([m(cc.Button)],e.prototype,"restartBtn",void 0),o([m(cc.Integer)],e.prototype,"row",void 0),o([m(cc.Integer)],e.prototype,"col",void 0),e=o([h],e)}(cc.Component);n.default=l,cc._RF.pop()},{"./Element/BgElement":"BgElement","./GameConst":"GameConst","./GameData":"GameData","./GameLogic":"GameLogic","./ResMgr":"ResMgr"}],ResMgr:[function(t,e,n){"use strict";cc._RF.push(e,"0672ejj2H5NFrgkhM9AJ8of","ResMgr");var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(t,e,n,r){var o,a=arguments.length,i=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,r);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(i=(a<3?o(i):a>3?o(e,n,i):o(e,n))||i);return a>3&&i&&Object.defineProperty(e,n,i),i};Object.defineProperty(n,"__esModule",{value:!0});var a=t("./GameData"),i=t("./GameConst"),c=cc._decorator,s=c.ccclass,u=(c.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}var n;return r(e,t),n=e,e.getSingleSpriteFrame=function(t){return cc.loader.getRes(t,cc.SpriteFrame)},e.getAtlasSpriteFrame=function(t,e){return cc.loader.getRes(t,cc.SpriteAtlas).getSpriteFrame(e)},e.getCardSprite=function(t){var e="";return e=i.GameConst.test?"card_"+Math.floor(4*Math.random())+"_"+t:"card_"+a.GameData.spriteKind+"_"+t,t==i.CardType.destory?e="card_4_14":t==i.CardType.destoryAll?e="card_4_15":t==i.CardType.back&&(e="card_back"),n.getAtlasSpriteFrame(i.GameConst.ElementPlist,e)},e=n=o([s],e)}(cc.Component));n.default=u,cc._RF.pop()},{"./GameConst":"GameConst","./GameData":"GameData"}],"use_v2.0.x_cc.Toggle_event":[function(t,e,n){"use strict";cc._RF.push(e,"3cf59PO3mdHbaUFst8VCwiX","use_v2.0.x_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_check=!0),cc._RF.pop()},{}]},{},["BgElement","GameElement","EventManager","Game","GameConst","GameData","GameLogic","GameScene","ResMgr","use_v2.0.x_cc.Toggle_event"]);